<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
<link href="https://file.myfontastic.com/ooB2GoYAbwY7Mg6wgzc96/icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
<link rel="stylesheet" href="css/materialize.css">
<link rel="stylesheet" href="css/style.css">
<script src="js/angular.min.js"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmAHM8giuTV9XaTpr7V8dtXVU7noA_mWY&libraries=places"></script>
<script type="text/javascript" src="js/iscroll.js"></script>
<script type="text/javascript" src="js/demoUtils.js"></script>
<script type="text/javascript">

  var myScroll;

  function loaded () {
    myScroll = new IScroll('#wrapper', { mouseWheel: true });


  }

  $.urlParam = function(name){
      var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
      if (results==null){
        return null;
      }
      else{
        return results[1] || 0;
      }
    }

    var id = $.urlParam('id');
    var app = angular.module('myApp', []);
    app.controller('customersCtrl', function($scope, $http) {
      $http.get("http://localhost/server/order_food.php?id="+id)
      .then(function (response) {$scope.names = response.data.records;});
    });



</script>
<style type="text/css">
.center{
  width: 150px;
  margin: 40px auto;
  
}
.input-group {
  position: relative;
  display: table;
  border-collapse: separate;
}
.input-group-btn {
  position: relative;
  font-size: 0;
  white-space: nowrap;
}
.input-group-addon, .input-group-btn {
  width: 1%;
  white-space: nowrap;
  vertical-align: middle;
}
.input-group-addon, .input-group-btn, .input-group .form-control {
  display: table-cell;
}
.form-control {
  display: block;
  width: 100%;
  height: 34px;
  padding: 6px 12px;
  font-size: 14px;
  line-height: 1.428571429;
  color: #555;
  background-color: #fff;
  background-image: none;
  border: 1px solid #ccc;
  border-radius: 4px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
  -webkit-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
  transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
}

#wrapper {
  position: absolute;
  z-index: 1;
  top: 0px;
  bottom: 48px;
  left: 0;
  width: 100%;
  
  overflow: hidden;
}

#scroller {
  position: absolute;
  z-index: 1;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  width: 100%;
  -webkit-transform: translateZ(0);
  -moz-transform: translateZ(0);
  -ms-transform: translateZ(0);
  -o-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-text-size-adjust: none;
  -moz-text-size-adjust: none;
  -ms-text-size-adjust: none;
  -o-text-size-adjust: none;
  text-size-adjust: none;
}

.abu
{
  color: #666666;
}



</style>
<body onload="loaded()">


  <div id="wrapper">
    <div id="scroller">
      <div class="container" ng-app="myApp" ng-controller="customersCtrl">
        <h5>Item to order</h5>
         <div id="food1" ng-repeat="x in names">
          <div class="row menu" style="border-bottom: 1px solid #e1e1e1;">
            <div class="col s7">
              <h5 style="font-weight: 600;color: #333;font-size: 1.2rem;">{{ x.nama_menu }}</h5>
              <h5 style="font-size: 1.2rem;" class="harganya">{{ x.harga }}</h5>
            </div>
            <div class="col s5" style="    padding-top: 7px;">
              <div class="input-group">
                
               <input type="text" name="quant{{ x.number }}[1]" class="form-control input-number" value="{{ x.qty }}" min="0" max="10" style="padding-left: 8px; margin-bottom: 9px; width: 50px; border-bottom: 0px;text-align: center;">
               
           </div>
         </div>
       </div>

      
 </div>
    

 <br>
 <h5>Delivery to</h5>
 <div clas="row">
  <div class="col s12">
    <input type="text" name="alamat_tujuan" id="searchTextField" placeholder="Alamat tujuan">
  </div>

  <div >
    <input id="lat" type="text" />
    <input id="lng" type="text" />
</div>
</div>
<br>

<h5>Pembayaran</h5>
<div class="row">
<div class="col s8">
   <p>
  <input name="group1" type="radio" id="test1" value="saldo" />
  <label for="test1">Obah Pay</label>
</p>
 </div>
 <div class="col s4 right-align" style="    padding-top: 15px;">
  <p class="obah_pay"></p>
  <input type="text" class="obah_pay" id="obah_pay">
</div>
</div>


<div class="row">
<div class="col s8">
   <p>
  <input name="group1" type="radio" id="test2" value="cash" />
  <label for="test2">Cash</label>
</p>
 </div>
 <div class="col s4 right-align"  style="    padding-top: 15px;">
  <p class="obah_cash"></p>
  <input type="text" class="obah_cash" id="obah_cash">
</div>
</div>

<br>

<h5>Payment Detail</h5>
<div class="row">
  <div class="col s8">
   <p class="abu"> Price </p>
 </div>
 <div class="col s4 right-align">
  12000
  <input type="text" id="harga_food">
</div>

<div class="col s8">
 <p class="abu" id="distance_p"> Delivery</p>
 <input type="hidden" class="distance">
</div>
<div class="col s4 right-align">
  9000
    <input type="text" id="harga_ojek">
</div>

<div class="col s12" style="border-bottom: 1px solid #DDD;margin-top: 5px;margin-bottom: 5px;"></div>
<div class="col s8">
 <p class="abu"> Total price </p>
</div>
<div class="col s4 right-align">
  21000
    <input type="text" id="total_harga">
</div>

<div class="col s8">
  <p class="abu">Pay with obah pay </p>
</div>
<div class="col s4 right-align">
  -7000
    <input type="text" id="pay_saldo">
</div>

<div class="col s8">
  <p class="abu">Pay with Cash </p>
</div>
<div class="col s4 right-align">
  16000
  <input type="text" id="pay_cash">
</div>
</div>
</div>
</div>
</div>

<div class="row" style="
position: absolute;
bottom: 0;
left: 0;
right: 0;
padding: 0px;
margin-bottom: 0px;">
<div class="col s12" style="padding: 0px;">
  <a class="waves-effect waves-light btn btn-large" style="width: 100%;border-radius: 0px;" id="btn_order">Order</a>
</div>
</div>
</body>

<script>
  $(document).ready(function(){
    var jml = $('.harganya').length;
    alert(jml);
    for (var i = 1; i <= jml; i++) {
      //alert($('.harganya').text());
    }
    
  });
       function initialize() {
          

          var input = document.getElementById('searchTextField');
          var autocomplete = new google.maps.places.Autocomplete(input);

          

          var infowindow = new google.maps.InfoWindow();
         

          google.maps.event.addListener(autocomplete, 'place_changed', function () {
              infowindow.close();
              var place = autocomplete.getPlace();

              updateTextFields(place.geometry.location.lat(),place.geometry.location.lng());

          });

          // Sets a listener on a radio button to change the filter type on Places
          // Autocomplete.
     

         
      }
      google.maps.event.addDomListener(window, 'load', initialize);

      function updateTextFields(lat, lng) {
          $('#lat').val(lat);
          $('#lng').val(lng);
          var id_resto = $.urlParam('id_resto');
           $.ajax({
            type: "POST",
            url: "http://localhost/server/get_distance.php",
            dataType: 'json',
            data:{lat:lat, lng:lng, id_resto:id_resto},
            success: function(data) {
              $('#distance_p').text('Delivery ('+data.jarak+' km)');
              $('.distance').val(data.jarak);
              $('.obah_cash').val(data.ojek);
              $('.obah_pay').val(data.dis_ojek);
            }
          });

      } 

      $('#btn_order').click(function(){
         var lat =   $('#lat').val();
         var long =  $('#lng').val();
         var alamat = $('#searchTextField').val();
         var obah_pay = $('#obah_pay').val();
         var obah_cash = $('#obah_cash').val();
         var id_resto = $.urlParam('id_resto');
         var kode_transaksi = $.urlParam('id');
          $.ajax({
            type: "POST",
            url: "http://localhost/server/post_food.php",
            dataType: 'json',
            data:{lat:lat, long:long, id_resto:id_resto, alamat:alamat, obah_pay:obah_pay, obah_cash:obah_cash, kode_transaksi:kode_transaksi},
            success: function(data) {
              
            }
          });
      });
</script>
<script type="text/javascript">

        //plugin bootstrap minus and plus
//http://jsfiddle.net/laelitenetwork/puJ6G/
$('.btn-number').click(function(e){
  e.preventDefault();

  fieldName = $(this).attr('data-field');
  type      = $(this).attr('data-type');
  var input = $("input[name='"+fieldName+"']");
  var currentVal = parseInt(input.val());
  if (!isNaN(currentVal)) {
    if(type == 'minus') {

      if(currentVal > input.attr('min')) {
        input.val(currentVal - 1).change();
      } 
      if(parseInt(input.val()) == input.attr('min')) {
        $(this).attr('disabled', true);
      }

    } else if(type == 'plus') {

      if(currentVal < input.attr('max')) {
        input.val(currentVal + 1).change();
      }
      if(parseInt(input.val()) == input.attr('max')) {
        $(this).attr('disabled', true);
      }

    }
  } else {
    input.val(0);
  }
});
$('.input-number').focusin(function(){
 $(this).data('oldValue', $(this).val());
});
$('.input-number').change(function() {

  minValue =  parseInt($(this).attr('min'));
  maxValue =  parseInt($(this).attr('max'));
  valueCurrent = parseInt($(this).val());

  name = $(this).attr('name');
  if(valueCurrent >= minValue) {
    $(".btn-number[data-type='minus'][data-field='"+name+"']").removeAttr('disabled')
  } else {
    alert('Sorry, the minimum value was reached');
    $(this).val($(this).data('oldValue'));
  }
  if(valueCurrent <= maxValue) {
    $(".btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
  } else {
    alert('Sorry, the maximum value was reached');
    $(this).val($(this).data('oldValue'));
  }


});
$(".input-number").keydown(function (e) {
        // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
             // Allow: Ctrl+A
             (e.keyCode == 65 && e.ctrlKey === true) || 
             // Allow: home, end, left, right
             (e.keyCode >= 35 && e.keyCode <= 39)) {
                 // let it happen, don't do anything
               return;
             }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
          e.preventDefault();
        }
      });
    </script>

